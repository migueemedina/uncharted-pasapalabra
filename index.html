<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Uncharted Mobile Debug</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        /* --- ESTILOS RESPONSIVE --- */
        :root {
            --bg-color: #2c241b;
            --text-color: #dcd0c0;
            --accent-gold: #eebb55;
            --accent-red: #d32f2f;
            --accent-green: #2e7d32;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            background-image: repeating-linear-gradient(45deg, #3e3226 0px, #3e3226 2px, #2c241b 2px, #2c241b 10px);
            color: var(--text-color);
            font-family: 'Special Elite', cursive;
            margin: 0;
            height: 100vh;
            height: 100dvh; /* Soporte mejorado para móviles */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Capas del juego: Una encima de otra */
        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 600px;
            max-height: 800px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Capa 1: El Título (Fondo) */
        .game-title {
            position: absolute;
            top: 5%;
            width: 100%;
            text-align: center;
            font-family: 'Cinzel', serif;
            font-size: clamp(20px, 6vw, 36px);
            color: var(--accent-gold);
            text-shadow: 2px 2px 0px #000;
            z-index: 1;
            pointer-events: none;
        }

        /* Capa 2: Las Letras (Rosco) */
        #letters-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none; /* Dejar pasar clicks al centro */
        }

        .letter-node {
            position: absolute;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: var(--accent-gold);
            border: 2px solid #5c4033;
            color: #3e2723;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 16px;
            font-family: 'Cinzel', serif;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
            /* Centrado inicial para evitar saltos */
            top: 50%; 
            left: 50%;
            margin-top: -19px;
            margin-left: -19px;
        }

        .letter-node.active {
            background: var(--accent-red);
            color: white;
            border-color: white;
            transform: scale(1.4) !important; /* Forzamos la escala */
            z-index: 10;
        }
        
        .letter-node.correct { background: var(--accent-green); color: white; }
        .letter-node.wrong { background: #5d4037; color: #ffab91; opacity: 0.6; }

        /* Capa 3: Interfaz (UI) */
        #ui-layer {
            z-index: 5;
            width: 85%;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: rgba(44, 36, 27, 0.6); /* Fondo semi-transparente para leer mejor */
            padding: 20px;
            border-radius: 20px;
            backdrop-filter: blur(2px);
        }

        #timer-ring {
            font-family: 'Cinzel', serif;
            font-size: 40px;
            color: #ffca28;
            text-shadow: 2px 2px 4px #000;
            margin: 0;
            line-height: 1;
        }

        .question-box {
            background: #f5e6ca;
            border: 3px double #5c4033;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            min-height: 110px;
            color: #3e2723;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hint-label {
            font-size: 14px;
            color: #bf360c;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            border-bottom: 2px solid #5c4033;
            display: inline-block;
            margin: 0 auto 5px auto;
        }

        .definition-text {
            font-size: clamp(14px, 4.5vw, 18px);
            line-height: 1.3;
            font-weight: bold;
        }

        .input-area {
            display: flex;
            gap: 5px;
            height: 45px;
        }

        input {
            flex: 1;
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--accent-gold);
            border-radius: 4px;
            color: var(--accent-gold);
            font-size: 18px;
            padding: 0 10px;
            font-family: 'Special Elite', serif;
            text-align: center;
            outline: none;
        }
        input::placeholder { color: #887766; }
        input:focus { border-color: #fff; background: rgba(0,0,0,0.6); }

        button {
            border: none;
            padding: 0 20px;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn-ok { background: var(--accent-gold); color: #3e2723; }
        .btn-pass { 
            background: transparent; color: #aaa; border: 1px solid #666; 
            width: 100%; padding: 12px; margin-top: 5px;
        }

        /* Pantalla Final */
        #end-screen {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(30, 20, 10, 0.98);
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        #end-screen h1 { font-family: 'Cinzel'; color: var(--accent-gold); }
        .restart-btn { margin-top: 30px; background: var(--accent-red); color: white; padding: 15px 30px; }

        /* MODO HORIZONTAL (Landscape) */
        @media (max-height: 500px) {
            .game-title { display: none; }
            #ui-layer { width: 60%; gap: 5px; padding: 10px; }
            .question-box { min-height: 60px; }
            #timer-ring { font-size: 25px; }
        }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div class="game-title">Uncharted Pasapalabra</div>
        
        <div id="letters-layer"></div>

        <div id="ui-layer">
            <div id="timer-ring">200</div>
            
            <div class="question-box">
                <div id="clue-type" class="hint-label">CARGANDO...</div>
                <div id="definition" class="definition-text">Si lees esto, el juego está listo.</div>
            </div>

            <div class="input-area">
                <input type="text" id="user-input" placeholder="Respuesta" autocomplete="off">
                <button class="btn-ok" onclick="verifyAnswer()">→</button>
            </div>
            <div>
                <button class="btn-pass" onclick="passTurn()">SALTAR</button>
            </div>
        </div>
    </div>

    <div id="end-screen">
        <h1 id="end-title">FIN</h1>
        <div id="end-score" style="color:#dcd0c0; font-size:20px;"></div>
        <button class="restart-btn" onclick="location.reload()">REINTENTAR</button>
    </div>

    <script>
        // --- DATOS DEL JUEGO ---
        const data = [
            { id: "a", letter: "A", answer: "Avery", type: 0, question: "Pirata cuyo tesoro busca Nathan en Uncharted 4." },
            { id: "b", letter: "B", answer: "Borneo", type: 0, question: "Isla donde comienza la acción de Uncharted 2." },
            { id: "c", letter: "C", answer: "Chloe", type: 0, question: "Cazatesoros australiana, compañera y rival." },
            { id: "d", letter: "D", answer: "Drake", type: 0, question: "Apellido adoptado por Nathan." },
            { id: "e", letter: "E", answer: "Elena", type: 0, question: "Periodista y gran amor de Nathan." },
            { id: "f", letter: "F", answer: "Francis", type: 0, question: "Nombre del navegante del anillo." },
            { id: "g", letter: "G", answer: "Granada", type: 0, question: "¡Cuidado, ______! (Explosivo)." },
            { id: "h", letter: "H", answer: "Harry", type: 0, question: "Nombre de pila de Flynn, el traidor." },
            { id: "i", letter: "I", answer: "Iram", type: 0, question: "La Atlántida de las Arenas: ____ de los Pilares." },
            { id: "j", letter: "J", answer: "Journal", type: 0, question: "Nombre en inglés del diario de notas." },
            { id: "k", letter: "K", answer: "Karl", type: 0, question: "Schäfer, explorador del Himalaya." },
            { id: "l", letter: "L", answer: "Libertalia", type: 0, question: "Colonia pirata utópica." },
            { id: "m", letter: "M", answer: "Marco", type: 0, question: "Polo, explorador veneciano." },
            { id: "n", letter: "N", answer: "Nadine", type: 0, question: "Líder de Shoreline." },
            { id: "ñ", letter: "Ñ", answer: "Compañero", type: 1, question: "CONTIENE LA Ñ: Como Sully llama a Nate." },
            { id: "o", letter: "O", answer: "Oro", type: 0, question: "Material del ídolo maldito." },
            { id: "p", letter: "P", answer: "Panama", type: 0, question: "País de la cárcel de Nate y Sam." },
            { id: "q", letter: "Q", answer: "Arqueologo", type: 1, question: "CONTIENE LA Q: Profesión de Drake." },
            { id: "r", letter: "R", answer: "Roman", type: 0, question: "Villano del primer juego." },
            { id: "s", letter: "S", answer: "Sully", type: 0, question: "Victor Sullivan." },
            { id: "t", letter: "T", answer: "Tenzin", type: 0, question: "Guía tibetano amigo de Drake." },
            { id: "u", letter: "U", answer: "Ubar", type: 0, question: "Ciudad perdida en el desierto." },
            { id: "v", letter: "V", answer: "Victor", type: 0, question: "Nombre real de Sully." },
            { id: "w", letter: "W", answer: "Marlowe", type: 1, question: "CONTIENE LA W: Villana de Uncharted 3." },
            { id: "x", letter: "X", answer: "Explorador", type: 1, question: "CONTIENE LA X: Persona que explora." },
            { id: "y", letter: "Y", answer: "Yemen", type: 0, question: "País donde secuestran a Drake." },
            { id: "z", letter: "Z", answer: "Zoran", type: 0, question: "Nombre de Lazarevic." },
        ];

        let currentIndex = 0;
        let timeLeft = 200;
        let interval;
        let roscoDOM = []; // Guardamos referencias a los Divs de las letras
        let gameActive = true;

        // --- FUNCIONES VISUALES ---
        
        function updateLayout() {
            const container = document.getElementById('game-wrapper');
            const lettersLayer = document.getElementById('letters-layer');
            
            // Calculamos el radio basado en lo más pequeño (ancho o alto)
            const minDim = Math.min(window.innerWidth, window.innerHeight);
            const radius = minDim * 0.40; // 40% del tamaño menor
            
            const centerX = lettersLayer.offsetWidth / 2;
            const centerY = lettersLayer.offsetHeight / 2;
            const total = data.length;

            // Movemos las letras ya existentes
            roscoDOM.forEach((div, i) => {
                let angle = (360 / total) * i - 90;
                let rad = angle * (Math.PI / 180);
                
                // Posición relativa al centro
                let x = Math.cos(rad) * radius;
                let y = Math.sin(rad) * radius;

                // Aplicamos translate desde el centro
                // Nota: CSS ya centra el div con top:50% left:50%
                div.style.transform = `translate(${x}px, ${y}px)`;

                // Si es la activa, agregamos escala visual extra si queremos
                if(div.classList.contains('active')) {
                     div.style.transform += " scale(1.4)";
                }
            });
        }

        function createLetters() {
            const layer = document.getElementById('letters-layer');
            layer.innerHTML = ''; // Limpiamos SOLO la capa de letras
            roscoDOM = [];

            data.forEach((item) => {
                let div = document.createElement('div');
                div.className = 'letter-node';
                div.innerText = item.letter;
                
                layer.appendChild(div);
                roscoDOM.push(div);
                item.status = 'pending';
            });
            
            // Posicionarlas
            updateLayout();
        }

        // --- LÓGICA DE JUEGO ---

        function startTimer() {
            interval = setInterval(() => {
                if(!gameActive) return;
                timeLeft--;
                document.getElementById('timer-ring').innerText = timeLeft;
                if(timeLeft <= 0) finishGame();
            }, 1000);
        }

        function updateUI() {
            if(!gameActive) return;

            // Buscar siguiente pendiente
            let found = false;
            let checks = 0;
            // Evitamos bucle infinito si todo está respondido
            while(checks < data.length) {
                if(data[currentIndex].status === 'pending') {
                    found = true;
                    break;
                }
                currentIndex++;
                if(currentIndex >= data.length) currentIndex = 0;
                checks++;
            }

            if (!found) {
                finishGame();
                return;
            }

            // Actualizar estado visual
            roscoDOM.forEach(l => l.classList.remove('active'));
            roscoDOM[currentIndex].classList.add('active');
            
            // Forzar actualización de posición para aplicar escala
            updateLayout();

            const current = data[currentIndex];
            document.getElementById('clue-type').innerText = current.type === 0 
                ? `EMPIEZA POR ${current.letter}` 
                : `CONTIENE LA ${current.letter}`;
            
            document.getElementById('definition').innerText = current.question;
            
            const input = document.getElementById('user-input');
            input.value = '';
            // En móvil, auto-focus puede ser molesto, lo quitamos por ahora
            // input.focus(); 
        }

        function verifyAnswer() {
            if(!gameActive) return;

            let input = document.getElementById('user-input').value.trim().toLowerCase();
            let correct = data[currentIndex].answer.toLowerCase();

            input = input.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            correct = correct.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            if(input === correct) {
                data[currentIndex].status = 'correct';
                roscoDOM[currentIndex].classList.add('correct');
            } else {
                data[currentIndex].status = 'wrong';
                roscoDOM[currentIndex].classList.add('wrong');
            }
            
            currentIndex++;
            if(currentIndex >= data.length) currentIndex = 0;
            updateUI();
        }

        function passTurn() {
            if(!gameActive) return;
            currentIndex++;
            if(currentIndex >= data.length) currentIndex = 0;
            updateUI();
        }

        function finishGame() {
            gameActive = false;
            clearInterval(interval);
            const correctCount = data.filter(d => d.status === 'correct').length;
            const wrongCount = data.filter(d => d.status === 'wrong').length;
            
            document.getElementById('end-screen').style.display = 'flex';
            
            let title = "TIEMPO AGOTADO";
            if(timeLeft > 0) title = "MISIÓN CUMPLIDA";
            if(correctCount === data.length) title = "¡SIC PARVIS MAGNA!";

            document.getElementById('end-title').innerText = title;
            document.getElementById('end-score').innerText = `Tesoros: ${correctCount} | Fallos: ${wrongCount}`;
        }

        // --- INICIALIZACIÓN SEGURA ---
        
        document.addEventListener("DOMContentLoaded", () => {
            // Ajustar al cambiar tamaño (girar móvil)
            window.addEventListener('resize', updateLayout);
            
            // Enter key
            document.getElementById('user-input').addEventListener('keydown', (e) => {
                if(e.key === 'Enter') verifyAnswer();
            });

            // Arrancar
            createLetters();
            startTimer();
            updateUI();
        });

    </script>
</body>
</html>